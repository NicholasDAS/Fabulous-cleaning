{% extends "base.html" %}
{% block content %}

<style>
    .step-box {
        display: none;
    }
    .step-active {
        display: block;
    }
    .step-indicator {
        width: 33%;
        height: 6px;
        background: #d1d1d1;
        border-radius: 10px;
        transition: 0.3s;
    }
    .step-indicator.active {
        background: #0d6efd;
    }
</style>

<div class="container mt-4 mb-5">

    <h2 class="fw-bold text-center mb-4">Book Your Cleaning Service</h2>

    <!-- =============================
         STEP INDICATOR
         ============================= -->
    <div class="d-flex justify-content-between mb-4">
        <div class="step-indicator" id="bar1"></div>
        <div class="step-indicator" id="bar2"></div>
        <div class="step-indicator" id="bar3"></div>
    </div>


    <!-- ======================================================
         STEP 1 — SERVICE SELECTION
         ====================================================== -->
    <form id="bookingForm" action="/booking" method="POST" enctype="multipart/form-data">

        <div id="step1" class="step-box step-active">

            <div class="card shadow-sm p-4">
                <h4 class="fw-bold mb-3">Step 1: Select Service & Date</h4>

                <div class="mb-3">
                    <label class="form-label">Select Service</label>
                    <select class="form-select" name="service_type" required>
                        <option value="">Choose a service...</option>
                        <option>Basic Home Cleaning</option>
                        <option>Deep Cleaning</option>
                        <option>Move-In / Move-Out Cleaning</option>
                        <option>Office / Commercial Cleaning</option>
                        <option>Post-Construction Cleaning</option>
                        <option>Airbnb / Rental Cleaning</option>
                        <option>Window Cleaning</option>
                        <option>Carpet & Upholstery Cleaning</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label class="form-label">Preferred Date</label>
                    <input type="date" class="form-control" name="date" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Preferred Time</label>
                    <input type="time" class="form-control" name="time" required>
                </div>

                <div class="mb-3">
                    <label class="form-label">Number of Rooms</label>
                    <select class="form-select" name="rooms" required>
                        <option value="">Select rooms...</option>
                        <option>1 Room</option>
                        <option>2 Rooms</option>
                        <option>3 Rooms</option>
                        <option>4 Rooms</option>
                        <option>5+ Rooms</option>
                    </select>
                </div>

                <button type="button" class="btn btn-primary w-100" onclick="nextStep(2)">
                    Next Step →
                </button>
            </div>

        </div>



        <!-- ======================================================
             STEP 2 — LOCATION, NOTES & PHOTOS
             ====================================================== -->
        <div id="step2" class="step-box">

            <div class="card shadow-sm p-4">
                <h4 class="fw-bold mb-3">Step 2: Location & Details</h4>

                <div class="mb-3">
                    <label class="form-label">Service Address</label>
                    <input type="text" class="form-control" name="address" required placeholder="Enter full address">
                </div>

                <div class="mb-3">
                    <label class="form-label">Additional Notes (Optional)</label>
                    <textarea class="form-control" name="note" rows="3" placeholder="Anything we should know?"></textarea>
                </div>

                <!-- PHOTO UPLOADS -->
                <label class="form-label">Upload Photos (Optional)</label>

                <div class="row g-3">

                    <div class="col-md-4">
                        <input type="file" class="form-control" name="photo1" accept="image/*" onchange="previewImage(this, 'p1')">
                        <img id="p1" class="img-fluid rounded mt-2 d-none" style="height: 120px; object-fit: cover;">
                    </div>

                    <div class="col-md-4">
                        <input type="file" class="form-control" name="photo2" accept="image/*" onchange="previewImage(this, 'p2')">
                        <img id="p2" class="img-fluid rounded mt-2 d-none" style="height: 120px; object-fit: cover;">
                    </div>

                    <div class="col-md-4">
                        <input type="file" class="form-control" name="photo3" accept="image/*" onchange="previewImage(this, 'p3')">
                        <img id="p3" class="img-fluid rounded mt-2 d-none" style="height: 120px; object-fit: cover;">
                    </div>

                </div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" onclick="nextStep(1)">← Back</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">Next Step →</button>
                </div>

            </div>

        </div>



        <!-- ======================================================
             STEP 3 — REVIEW & CONFIRM
             ====================================================== -->
        <div id="step3" class="step-box">

            <div class="card shadow-sm p-4">
                <h4 class="fw-bold mb-3">Step 3: Review & Confirm</h4>

                <div id="reviewBox" class="mb-3 p-3 bg-light rounded border"></div>

                <div class="d-flex justify-content-between mt-4">
                    <button type="button" class="btn btn-secondary" onclick="nextStep(2)">← Back</button>
                    <button type="submit" class="btn btn-success">Confirm Booking ✔</button>
                </div>

            </div>

        </div>

    </form>

</div>


<!-- ======================================================
     JAVASCRIPT FOR MULTI-STEP WIZARD
     ====================================================== -->
<script>
    // Change step visually
    function nextStep(step) {
        document.querySelectorAll('.step-box').forEach(box => box.classList.remove('step-active'));
        document.getElementById("step" + step).classList.add("step-active");

        // Update progress bars
        document.getElementById("bar1").classList.toggle("active", step >= 1);
        document.getElementById("bar2").classList.toggle("active", step >= 2);
        document.getElementById("bar3").classList.toggle("active", step === 3);

        // Fill summary on step 3
        if (step === 3) {
            fillSummary();
        }
    }

    // Display image preview
    function previewImage(input, id) {
        const file = input.files[0];
        const img = document.getElementById(id);

        if (file) {
            img.src = URL.createObjectURL(file);
            img.classList.remove("d-none");
        }
    }

    // Create review summary
    function fillSummary() {
        const form = document.getElementById("bookingForm");

        const summary = `
            <strong>Service:</strong> ${form.service_type.value}<br>
            <strong>Date:</strong> ${form.date.value}<br>
            <strong>Time:</strong> ${form.time.value}<br>
            <strong>Rooms:</strong> ${form.rooms.value}<br><hr>

            <strong>Address:</strong> ${form.address.value}<br>
            <strong>Notes:</strong> ${form.note.value || "No notes provided"}<br>
        `;

        document.getElementById("reviewBox").innerHTML = summary;
    }
</script>

{% endblock %}
